<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cycle Tracker - Suivi du Cycle Menstruel</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/recharts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // Configuration Supabase
        const SUPABASE_URL = 'https://ubkgibanqyeufczdqgay.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVia2dpYmFucXlldWZjemRxZ2F5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2NDkxMDgsImV4cCI6MjA2NzIyNTEwOH0.HyIniqVC8xU6U9XZAprd3me00WWuUhvijZE73ys5ccU';
        
        // Icônes simples en SVG
        const Calendar = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );
        
        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );
        
        const Save = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17,21 17,13 7,13 7,21"></polyline>
                <polyline points="7,3 7,8 15,8"></polyline>
            </svg>
        );
        
        const Edit3 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg>
        );
        
        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );
        
        const Database = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
            </svg>
        );
        
        const TrendingUp = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );
        
        const AlertCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );
        
        // Service Supabase
        class SupabaseService {
            constructor() {
                this.baseUrl = `${SUPABASE_URL}/rest/v1/cycles`;
                this.headers = {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=representation'
                };
            }
            
            async getAllCycles() {
                const response = await fetch(`${this.baseUrl}?order=start_date.asc`, {
                    headers: this.headers
                });
                
                if (!response.ok) {
                    throw new Error(`Erreur: ${response.status}`);
                }
                
                const data = await response.json();
                return data.map(cycle => ({
                    id: cycle.id,
                    startDate: cycle.start_date,
                    endDate: cycle.end_date,
                    flow: cycle.flow || 'normal',
                    symptoms: cycle.symptoms || [],
                    preSymptoms: cycle.pre_symptoms || [],
                    notes: cycle.notes || '',
                    length: cycle.length || this.calculateLength(cycle.start_date, cycle.end_date)
                }));
            }
            
            async createCycle(cycleData) {
                const supabaseData = {
                    start_date: cycleData.startDate,
                    end_date: cycleData.endDate,
                    flow: cycleData.flow,
                    symptoms: cycleData.symptoms,
                    pre_symptoms: cycleData.preSymptoms,
                    notes: cycleData.notes,
                    length: cycleData.length
                };
                
                const response = await fetch(this.baseUrl, {
                    method: 'POST',
                    headers: this.headers,
                    body: JSON.stringify(supabaseData)
                });
                
                if (!response.ok) {
                    throw new Error(`Erreur: ${response.status}`);
                }
                
                const data = await response.json();
                return {
                    id: data[0].id,
                    startDate: data[0].start_date,
                    endDate: data[0].end_date,
                    flow: data[0].flow,
                    symptoms: data[0].symptoms || [],
                    preSymptoms: data[0].pre_symptoms || [],
                    notes: data[0].notes || '',
                    length: data[0].length
                };
            }
            
            calculateLength(startDate, endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                return Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            }
        }
        
        const CycleTracker = () => {
            const [cycles, setCycles] = useState([]);
            const [isAddingCycle, setIsAddingCycle] = useState(false);
            const [editingCycle, setEditingCycle] = useState(null);
            const [loading, setLoading] = useState(false);
            const [success, setSuccess] = useState(null);
            const [error, setError] = useState(null);
            const [supabaseConfigured, setSupabaseConfigured] = useState(true);
            const [newCycle, setNewCycle] = useState({
                startDate: '',
                endDate: '',
                flow: 'normal',
                symptoms: [],
                preSymptoms: [],
                notes: ''
            });
            
            const supabaseService = new SupabaseService();
            
            // Charger les données au démarrage
            useEffect(() => {
                loadCycles();
            }, []);
            
            const loadCycles = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    const supabaseCycles = await supabaseService.getAllCycles();
                    setCycles(supabaseCycles);
                    localStorage.setItem('menstrualCycles', JSON.stringify(supabaseCycles));
                } catch (err) {
                    console.error('Erreur:', err);
                    setError('Erreur de connexion. Chargement des données locales...');
                    
                    const localCycles = localStorage.getItem('menstrualCycles');
                    if (localCycles) {
                        setCycles(JSON.parse(localCycles));
                    }
                } finally {
                    setLoading(false);
                }
            };
            
            const symptoms = [
                'Crampes', 'Maux de tête', 'Fatigue', 'Ballonnements', 
                'Sautes d\'humeur', 'Douleurs mammaires', 'Nausées', 'Acné'
            ];
            
            const preSymptoms = [
                'Irritabilité', 'Fringales', 'Sensibilité mammaire', 'Ballonnements',
                'Fatigue', 'Maux de tête', 'Sautes d\'humeur', 'Troubles du sommeil',
                'Douleurs abdominales', 'Anxiété', 'Déprime', 'Rétention d\'eau'
            ];
            
            const calculateCycleLength = (startDate, endDate) => {
                const start = new Date(startDate);
                const end = new Date(endDate);
                return Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            };
            
            const calculateDaysBetweenCycles = (prevEndDate, nextStartDate) => {
                const prevEnd = new Date(prevEndDate);
                const nextStart = new Date(nextStartDate);
                return Math.ceil((nextStart - prevEnd) / (1000 * 60 * 60 * 24)) - 1;
            };
            
            const predictNextCycle = useMemo(() => {
                if (cycles.length < 2) return null;
                
                // Calculer les intervalles entre cycles
                const intervals = [];
                for (let i = 1; i < cycles.length; i++) {
                    const prevCycle = cycles[i - 1];
                    const currentCycle = cycles[i];
                    const daysBetween = calculateDaysBetweenCycles(prevCycle.endDate, currentCycle.startDate);
                    intervals.push(daysBetween);
                }
                
                // Calculer la durée moyenne des cycles
                const cycleLengths = cycles.map(c => c.length);
                const avgCycleLength = cycleLengths.reduce((a, b) => a + b, 0) / cycleLengths.length;
                
                // Calculer l'intervalle moyen
                const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                
                // Prédire le prochain cycle
                const lastCycle = cycles[cycles.length - 1];
                const lastEndDate = new Date(lastCycle.endDate);
                
                // Date de début prévue = dernière date de fin + intervalle moyen
                const predictedStartDate = new Date(lastEndDate);
                predictedStartDate.setDate(predictedStartDate.getDate() + Math.round(avgInterval) + 1);
                
                // Date de fin prévue = date de début + durée moyenne
                const predictedEndDate = new Date(predictedStartDate);
                predictedEndDate.setDate(predictedEndDate.getDate() + Math.round(avgCycleLength) - 1);
                
                // Calculer les jours restants
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                predictedStartDate.setHours(0, 0, 0, 0);
                
                const daysUntilNext = Math.ceil((predictedStartDate - today) / (1000 * 60 * 60 * 24));
                
                // Calculer la confiance de la prédiction
                const intervalVariation = Math.max(...intervals) - Math.min(...intervals);
                const lengthVariation = Math.max(...cycleLengths) - Math.min(...cycleLengths);
                const confidence = intervals.length >= 3 && intervalVariation <= 7 && lengthVariation <= 3 ? 'élevée' : 
                                 intervals.length >= 2 && intervalVariation <= 10 ? 'moyenne' : 'faible';
                
                return {
                    startDate: predictedStartDate,
                    endDate: predictedEndDate,
                    daysUntilNext,
                    avgCycleLength: Math.round(avgCycleLength),
                    avgInterval: Math.round(avgInterval),
                    confidence,
                    intervalVariation,
                    lengthVariation
                };
            }, [cycles]);
            
            const addCycle = async () => {
                if (!newCycle.startDate || !newCycle.endDate) {
                    setError('Veuillez remplir les dates de début et de fin');
                    return;
                }
                
                const startDate = new Date(newCycle.startDate);
                const endDate = new Date(newCycle.endDate);
                
                if (endDate < startDate) {
                    setError('La date de fin doit être après la date de début');
                    return;
                }
                
                setLoading(true);
                setError(null);
                
                try {
                    const cycleLength = calculateCycleLength(newCycle.startDate, newCycle.endDate);
                    const cycleToAdd = { ...newCycle, length: cycleLength };
                    
                    const createdCycle = await supabaseService.createCycle(cycleToAdd);
                    const updatedCycles = [...cycles, createdCycle].sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                    setCycles(updatedCycles);
                    localStorage.setItem('menstrualCycles', JSON.stringify(updatedCycles));
                    
                    setNewCycle({
                        startDate: '',
                        endDate: '',
                        flow: 'normal',
                        symptoms: [],
                        preSymptoms: [],
                        notes: ''
                    });
                    
                    setIsAddingCycle(false);
                    setSuccess('Cycle ajouté avec succès !');
                    setTimeout(() => setSuccess(null), 3000);
                    
                } catch (err) {
                    console.error('Erreur:', err);
                    setError(`Erreur lors de l'ajout: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };
            
            const exportData = () => {
                const dataStr = JSON.stringify(cycles, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `cycles-menstruels-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                setSuccess('Données exportées avec succès !');
                setTimeout(() => setSuccess(null), 3000);
            };
            
            const stats = useMemo(() => {
                if (cycles.length === 0) return null;
                
                const lengths = cycles.map(c => c.length);
                const avgLength = lengths.reduce((a, b) => a + b, 0) / lengths.length;
                const lengthVariation = Math.max(...lengths) - Math.min(...lengths);
                
                return {
                    avgLength: avgLength.toFixed(1),
                    lengthVariation,
                    totalCycles: cycles.length
                };
            }, [cycles]);
            
            const getFlowColor = (flow) => {
                switch (flow) {
                    case 'light': return 'bg-pink-200';
                    case 'normal': return 'bg-pink-400';
                    case 'heavy': return 'bg-pink-600';
                    default: return 'bg-pink-400';
                }
            };
            
            const getFlowText = (flow) => {
                switch (flow) {
                    case 'light': return 'Léger';
                    case 'normal': return 'Normal';
                    case 'heavy': return 'Abondant';
                    default: return 'Normal';
                }
            };
            
            return (
                <div className="max-w-6xl mx-auto p-6 bg-gradient-to-br from-pink-50 to-purple-50 min-h-screen">
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                            <div className="flex items-center gap-3">
                                <Calendar />
                                <h1 className="text-2xl md:text-3xl font-bold text-gray-800">Suivi du Cycle Menstruel</h1>
                                <div className="flex items-center gap-1 text-green-600 text-sm">
                                    <Database />
                                    <span>Synchronisé</span>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={exportData}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors text-sm"
                                >
                                    <Save />
                                    Exporter
                                </button>
                                <button
                                    onClick={() => setIsAddingCycle(true)}
                                    disabled={loading}
                                    className="bg-pink-600 hover:bg-pink-700 disabled:bg-pink-300 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors text-sm"
                                >
                                    <Plus />
                                    Ajouter
                                </button>
                            </div>
                        </div>
                        
                        {success && (
                            <div className="bg-green-100 border-l-4 border-green-400 p-4 mb-6">
                                <div className="text-green-700">{success}</div>
                            </div>
                        )}
                        
                        {/* Section Prévisions */}
                        {predictNextCycle && (
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <TrendingUp />
                                    Prévisions du prochain cycle
                                </h2>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Prédiction principale */}
                                    <div className="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-lg">
                                        <h3 className="font-semibold text-lg mb-3 text-purple-800">Prochain cycle prévu</h3>
                                        
                                        {predictNextCycle.daysUntilNext > 0 ? (
                                            <div className="space-y-2">
                                                <div className="text-3xl font-bold text-purple-900">
                                                    Dans {predictNextCycle.daysUntilNext} jour{predictNextCycle.daysUntilNext > 1 ? 's' : ''}
                                                </div>
                                                <div className="text-purple-700">
                                                    <div><strong>Début prévu :</strong> {predictNextCycle.startDate.toLocaleDateString('fr-FR', { 
                                                        weekday: 'long', 
                                                        year: 'numeric', 
                                                        month: 'long', 
                                                        day: 'numeric' 
                                                    })}</div>
                                                    <div><strong>Fin prévue :</strong> {predictNextCycle.endDate.toLocaleDateString('fr-FR', { 
                                                        weekday: 'long', 
                                                        year: 'numeric', 
                                                        month: 'long', 
                                                        day: 'numeric' 
                                                    })}</div>
                                                    <div><strong>Durée prévue :</strong> {predictNextCycle.avgCycleLength} jours</div>
                                                </div>
                                            </div>
                                        ) : predictNextCycle.daysUntilNext === 0 ? (
                                            <div className="text-2xl font-bold text-pink-900">
                                                Votre cycle devrait commencer aujourd'hui !
                                            </div>
                                        ) : (
                                            <div className="space-y-2">
                                                <div className="text-2xl font-bold text-orange-900">
                                                    En retard de {Math.abs(predictNextCycle.daysUntilNext)} jour{Math.abs(predictNextCycle.daysUntilNext) > 1 ? 's' : ''}
                                                </div>
                                                <div className="text-orange-700">
                                                    <div><strong>Était prévu le :</strong> {predictNextCycle.startDate.toLocaleDateString('fr-FR')}</div>
                                                    <div className="text-sm mt-2">Les cycles peuvent varier naturellement</div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Fiabilité et conseils */}
                                    <div className="bg-gradient-to-r from-blue-100 to-indigo-100 p-6 rounded-lg">
                                        <h3 className="font-semibold text-lg mb-3 text-blue-800">Fiabilité de la prédiction</h3>
                                        
                                        <div className="space-y-3">
                                            <div className="flex items-center gap-2">
                                                <div className={`w-3 h-3 rounded-full ${
                                                    predictNextCycle.confidence === 'élevée' ? 'bg-green-500' :
                                                    predictNextCycle.confidence === 'moyenne' ? 'bg-yellow-500' : 'bg-red-500'
                                                }`}></div>
                                                <span className="font-medium">Confiance {predictNextCycle.confidence}</span>
                                            </div>
                                            
                                            <div className="text-sm text-blue-700 space-y-1">
                                                <div>• Basé sur {cycles.length} cycles enregistrés</div>
                                                <div>• Variation durée : {predictNextCycle.lengthVariation} jours</div>
                                                <div>• Variation intervalle : {predictNextCycle.intervalVariation} jours</div>
                                            </div>
                                            
                                            {predictNextCycle.confidence === 'faible' && (
                                                <div className="bg-yellow-100 border-l-4 border-yellow-400 p-3 mt-3">
                                                    <div className="flex items-center">
                                                        <AlertCircle />
                                                        <div className="ml-2 text-yellow-800 text-sm">
                                                            <div className="font-medium">Prédiction approximative</div>
                                                            <div>Enregistrez plus de cycles pour améliorer la précision</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                            
                                            {predictNextCycle.confidence === 'élevée' && (
                                                <div className="bg-green-100 border-l-4 border-green-400 p-3 mt-3">
                                                    <div className="text-green-800 text-sm">
                                                        <div className="font-medium">Prédiction fiable</div>
                                                        <div>Vos cycles sont réguliers</div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Phase du cycle actuel */}
                                <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <h4 className="font-medium mb-2">Phase actuelle estimée</h4>
                                    {(() => {
                                        const today = new Date();
                                        const lastCycle = cycles[cycles.length - 1];
                                        const daysSinceLastCycle = Math.ceil((today - new Date(lastCycle.endDate)) / (1000 * 60 * 60 * 24));
                                        const totalCycleLength = predictNextCycle.avgCycleLength + predictNextCycle.avgInterval;
                                        const cycleDay = daysSinceLastCycle;
                                        
                                        let phase, description, color;
                                        
                                        if (cycleDay <= 5) {
                                            phase = "Post-menstruelle";
                                            description = "Phase de récupération";
                                            color = "text-blue-600";
                                        } else if (cycleDay <= Math.round(totalCycleLength * 0.4)) {
                                            phase = "Folliculaire";
                                            description = "Phase d'énergie croissante";
                                            color = "text-green-600";
                                        } else if (cycleDay <= Math.round(totalCycleLength * 0.6)) {
                                            phase = "Ovulation";
                                            description = "Phase fertile";
                                            color = "text-yellow-600";
                                        } else if (cycleDay <= Math.round(totalCycleLength * 0.9)) {
                                            phase = "Lutéale";
                                            description = "Phase prémenstruelle";
                                            color = "text-orange-600";
                                        } else {
                                            phase = "Prémenstruelle";
                                            description = "Cycle attendu bientôt";
                                            color = "text-red-600";
                                        }
                                        
                                        return (
                                            <div className="flex items-center gap-4">
                                                <div className={`font-semibold ${color}`}>{phase}</div>
                                                <div className="text-gray-600">{description}</div>
                                                <div className="text-sm text-gray-500">Jour {cycleDay} du cycle</div>
                                            </div>
                                        );
                                    })()}
                                </div>
                            </div>
                        )}
                        
                        {error && (
                            <div className="bg-red-100 border-l-4 border-red-400 p-4 mb-6">
                                <div className="text-red-800">{error}</div>
                            </div>
                        )}
                        
                        {stats && (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div className="bg-gradient-to-r from-pink-100 to-pink-200 p-4 rounded-lg">
                                    <div className="text-pink-800 font-semibold">Durée moyenne</div>
                                    <div className="text-2xl font-bold text-pink-900">{stats.avgLength} jours</div>
                                </div>
                                <div className="bg-gradient-to-r from-blue-100 to-blue-200 p-4 rounded-lg">
                                    <div className="text-blue-800 font-semibold">Variation</div>
                                    <div className="text-2xl font-bold text-blue-900">{stats.lengthVariation} jours</div>
                                </div>
                                <div className="bg-gradient-to-r from-green-100 to-green-200 p-4 rounded-lg">
                                    <div className="text-green-800 font-semibold">Total cycles</div>
                                    <div className="text-2xl font-bold text-green-900">{stats.totalCycles}</div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <h2 className="text-xl font-bold mb-4">Historique des cycles</h2>
                        {cycles.length === 0 ? (
                            <div className="text-center py-8 text-gray-500">
                                <Calendar />
                                <p className="mt-4">Aucun cycle enregistré pour le moment.</p>
                                <p>Cliquez sur "Ajouter" pour commencer votre suivi.</p>
                            </div>
                        ) : (
                            <div className="grid gap-4">
                                {cycles.map((cycle, index) => (
                                    <div key={cycle.id} className="border rounded-lg p-4 hover:shadow-md transition-shadow">
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-4 mb-2">
                                                    <h3 className="font-semibold text-lg">Cycle {index + 1}</h3>
                                                    <div className={`px-2 py-1 rounded text-white text-sm ${getFlowColor(cycle.flow)}`}>
                                                        {getFlowText(cycle.flow)}
                                                    </div>
                                                </div>
                                                <div className="text-gray-600 mb-2">
                                                    <span className="font-medium">Du:</span> {new Date(cycle.startDate).toLocaleDateString('fr-FR')} 
                                                    <span className="mx-2">-</span>
                                                    <span className="font-medium">Au:</span> {new Date(cycle.endDate).toLocaleDateString('fr-FR')}
                                                    <span className="mx-2">•</span>
                                                    <span className="font-medium">Durée:</span> {cycle.length} jours
                                                </div>
                                                {cycle.symptoms && cycle.symptoms.length > 0 && (
                                                    <div className="mb-2">
                                                        <span className="font-medium text-gray-700">Symptômes pendant:</span>
                                                        <div className="flex flex-wrap gap-1 mt-1">
                                                            {cycle.symptoms.map(symptom => (
                                                                <span key={symptom} className="bg-red-100 text-red-700 px-2 py-1 rounded text-sm">
                                                                    {symptom}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                                {cycle.preSymptoms && cycle.preSymptoms.length > 0 && (
                                                    <div className="mb-2">
                                                        <span className="font-medium text-gray-700">Symptômes avant:</span>
                                                        <div className="flex flex-wrap gap-1 mt-1">
                                                            {cycle.preSymptoms.map(symptom => (
                                                                <span key={symptom} className="bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm">
                                                                    {symptom}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                                {cycle.notes && (
                                                    <div className="text-gray-600">
                                                        <span className="font-medium">Notes:</span> {cycle.notes}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    
                    {isAddingCycle && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center p-2 sm:p-4 z-50 overflow-y-auto">
                            <div className="bg-white rounded-lg w-full max-w-lg mx-auto my-4 sm:my-8 flex flex-col max-h-[calc(100vh-2rem)] sm:max-h-[calc(100vh-4rem)]">
                                <div className="p-4 sm:p-6 border-b bg-white rounded-t-lg">
                                    <h2 className="text-xl font-bold">
                                        {editingCycle ? 'Modifier le cycle' : 'Ajouter un nouveau cycle'}
                                    </h2>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-4 sm:p-6">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Date de début *</label>
                                            <input
                                                type="date"
                                                value={newCycle.startDate}
                                                onChange={(e) => setNewCycle(prev => ({ ...prev, startDate: e.target.value }))}
                                                className="w-full p-3 border rounded-lg focus:border-pink-500 focus:outline-none text-base"
                                                required
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Date de fin *</label>
                                            <input
                                                type="date"
                                                value={newCycle.endDate}
                                                onChange={(e) => setNewCycle(prev => ({ ...prev, endDate: e.target.value }))}
                                                className="w-full p-3 border rounded-lg focus:border-pink-500 focus:outline-none text-base"
                                                required
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Intensité du flux</label>
                                            <select
                                                value={newCycle.flow}
                                                onChange={(e) => setNewCycle(prev => ({ ...prev, flow: e.target.value }))}
                                                className="w-full p-3 border rounded-lg focus:border-pink-500 focus:outline-none text-base"
                                            >
                                                <option value="light">Léger</option>
                                                <option value="normal">Normal</option>
                                                <option value="heavy">Abondant</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Symptômes avant le cycle (SPM)</label>
                                            <div className="border rounded-lg p-3 max-h-40 overflow-y-auto bg-gray-50">
                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                    {preSymptoms.map(symptom => (
                                                        <label key={symptom} className="flex items-center text-sm py-1">
                                                            <input
                                                                type="checkbox"
                                                                checked={newCycle.preSymptoms.includes(symptom)}
                                                                onChange={(e) => {
                                                                    const isChecked = e.target.checked;
                                                                    setNewCycle(prev => ({
                                                                        ...prev,
                                                                        preSymptoms: isChecked 
                                                                            ? [...prev.preSymptoms, symptom]
                                                                            : prev.preSymptoms.filter(s => s !== symptom)
                                                                    }));
                                                                }}
                                                                className="mr-2"
                                                            />
                                                            <span>{symptom}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Symptômes pendant le cycle</label>
                                            <div className="border rounded-lg p-3 max-h-40 overflow-y-auto bg-gray-50">
                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                    {symptoms.map(symptom => (
                                                        <label key={symptom} className="flex items-center text-sm py-1">
                                                            <input
                                                                type="checkbox"
                                                                checked={newCycle.symptoms.includes(symptom)}
                                                                onChange={(e) => {
                                                                    const isChecked = e.target.checked;
                                                                    setNewCycle(prev => ({
                                                                        ...prev,
                                                                        symptoms: isChecked 
                                                                            ? [...prev.symptoms, symptom]
                                                                            : prev.symptoms.filter(s => s !== symptom)
                                                                    }));
                                                                }}
                                                                className="mr-2"
                                                            />
                                                            <span>{symptom}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Notes</label>
                                            <textarea
                                                value={newCycle.notes}
                                                onChange={(e) => setNewCycle(prev => ({ ...prev, notes: e.target.value }))}
                                                className="w-full p-3 border rounded-lg focus:border-pink-500 focus:outline-none text-base resize-none"
                                                rows="3"
                                                placeholder="Notes optionnelles..."
                                            />
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="p-4 sm:p-6 border-t bg-white rounded-b-lg">
                                    <div className="flex flex-col sm:flex-row gap-3">
                                        <button
                                            onClick={addCycle}
                                            disabled={loading || !newCycle.startDate || !newCycle.endDate}
                                            className="flex-1 bg-pink-600 hover:bg-pink-700 disabled:bg-pink-300 text-white py-3 px-4 rounded-lg transition-colors font-medium text-base order-2 sm:order-1"
                                        >
                                            {loading ? 'Traitement...' : 'Ajouter'}
                                        </button>
                                        <button
                                            onClick={() => {
                                                setIsAddingCycle(false);
                                                setError(null);
                                                setNewCycle({
                                                    startDate: '',
                                                    endDate: '',
                                                    flow: 'normal',
                                                    symptoms: [],
                                                    preSymptoms: [],
                                                    notes: ''
                                                });
                                            }}
                                            disabled={loading}
                                            className="flex-1 bg-gray-300 hover:bg-gray-400 disabled:bg-gray-200 text-gray-800 py-3 px-4 rounded-lg transition-colors font-medium text-base order-1 sm:order-2"
                                        >
                                            Annuler
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        ReactDOM.render(<CycleTracker />, document.getElementById('root'));
    </script>
</body>
</html>
